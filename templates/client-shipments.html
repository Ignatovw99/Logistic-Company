{% extends 'base.html' %}
{% include 'header.html' %}



{% block title %} Shipments {% endblock %}



{% block body %}

<div class="container">
    <div class="row">
        <div class="col md-12">

            <div class="jumbotron p-3">

                <h2>Manage <b>Shipments</b>  <button type="button"  class="btn btn-success float-right"
                data-toggle="modal" data-target="#mymodal">Add New Shipment</button> </h2>


                {% with messages = get_flashed_messages() %}

                {% if messages %}

                {% for message in messages %}

                <div class="alert alert-success alert-dismissable" role="alert">

                    <button type="button" class="close" data-dismiss="alert" aria-label="close">

                        <span aria-hidden="true">x</span>

                    </button>


                {{message}}


                </div>


                {% endfor %}

                {% endif %}
                {% endwith %}
            <form action="{{url_for('shipment_by_id')}}" method="POST">
                 Filter by shipment's id:<input type="number"  name="id_shipment" value="">
                  <button class="btn btn-primary" type="submit">Filter</button>
              </form>

              <form action="{{url_for('send_by_client_shipments')}}" method="POST">
                Filter by sender id:<input type="number"  name="id_sender" value={{ id }}>
                  <button class="btn btn-primary" type="submit">Filter</button>
              </form>
            <form action="{{url_for('received_by_client_shipments')}}" method="POST">
                Filter by receiver id:<input type="number"  name="id_receiver" value="">
                  <button class="btn btn-primary" type="submit">Filter</button>
              </form>
            <form action="{{url_for('shipments_registered_by_employee')}}" method="POST">
                 Filter by employee's id:<input type="number"  name="id_employee" value="">
                  <button class="btn btn-primary" type="submit">Filter</button>
              </form>
            <form action="{{url_for('shipments_status')}}" method="POST">
                Filter by status:<select  name="status_filter" value=" ">
                         {% for row in statuses %}
                        <option value={{row}}> {{row}}</option>
                        {% endfor %}

                    </select>
                  <button class="btn btn-primary" type="submit">Filter</button>
              </form>






                <table class="table table-hover table-dark">

                    <tr>

                        <th>ID</th>
                        <th>Weight</th>
                        <th>Status</th>
                        <th>From</th>
                        <th>To</th>
                        <th>Sender</th>
                        <th>Receiver</th>
                        <th>Acceptor</th>
                        <th>Deliverer</th>
                        <th>Price</th>
                        <th>Action</th>

                    </tr>


                   {% for row in shipments_client %}


                    <tr>
                        <td>{{row.id}}</td>
                        <td>{{row.weight}}</td>
                        <td>{{row.status}}</td>
                        <td>{{row.from_address_id}}</td>
                        <td>{{row.to_address_id}}</td>
                        <td>{{row.sender}}</td>
                        <td>{{row.receiver}}</td>
                        <td>{{row.acceptor}}</td>
                        <td>{{row.deliverer}}</td>
                        <td>{{row.price}}</td>


                        <td>
                            <a href="/update/{{row.id}}" class="btn btn-warning btn-xs" data-toggle="modal" data-target="#modaledit{{row.id}}">Edit</a>
                            <a href="/client_shipments/delete/{{row.id}}" class="btn btn-danger btn-xs"  >Delete</a>


                        </td>

                    </tr>






<div id="modaledit{{row.id}}" class="modal fade" role="dialog">
   <div class="modal-dialog">


      <div class="modal-content">


         <div class="modal-header">


            <h4 class="modal-title">Update Information</h4>


         </div>


         <div class="modal-body">


            <form action="{{url_for('update_shipping_clients')}}" method="POST">


               <div class="form-group">

                  <label>Weight:</label>
                   <input type="hidden"  name="id" value="{{row.id}}">
                  <input type="number" class="form-control" name="weight" id="weightUpdate" value="{{row.weight}}">

               </div>





                <div class="form-group">

                  <label>From:</label>

                <input type="radio" id="from_office_update" name="optionsFrom" value="office" onClick="javascript:return checkedFunctionUpdate('from_office_update')" checked>
                          <label for="from_office_update">Office</label>
                  <input type="radio" id="from_address_update" name="optionsFrom" value="address" onClick="javascript:return checkedFunctionUpdate('from_address_update')" checked>
                          <label for="from_address_update">Address</label>



                    <input id="from_address_text_update" type="text" class="form-control" name="fromAddressText" value="{{ row.from_address_id }}" >
                <div id="select_from_office_update" style = "display:none" >
                    <select  name="selectFromOffice" value="{{ row.from_address_id }}">
                         {% for row in offices %}
                        <option value={{row.id}}> {{row.id}}, {{row.address}} </option>
                        {% endfor %}

                    </select>
                </div>


               </div>



               <div class="form-group">


                  <label>To:</label>

                    <input type="radio" id="to_office_update" name="optionsTo" value="office" onClick="javascript:return checkedToFunctionUpdate('to_office_update')" checked>
                          <label for="from_office_update">Office</label>
                  <input type="radio" id="to_address_update" name="optionsTo" value="address" onClick="javascript:return checkedToFunctionUpdate('to_address_update')" checked>
                          <label for="from_address_update">Address</label>




                    <input id="to_address_text_update" type="text" class="form-control" name="toAddressText" value="{{ row.to_address_id }}">

                    <div id="select_to_office_update" style = "display:none">
                    <select  name="selectToOffice" value = "{{ row.to_address_id }}">
                         {% for row in offices %}
                        <option value={{row.id}}> {{row.id}}, {{row.address}} </option>
                        {% endfor %}

                    </select>
                    </div>




               </div>


                <div class="form-group">


                  <label>Sender</label>
                  <label> First name:</label>
                  <input type="text" class="form-control" name="senderFirstName" value="{{row.sender.first_name}}">


               </div>
            <div class="form-group">



                  <label>Last name:</label>
                  <input type="text" class="form-control" name="senderLastName" value="{{row.sender.last_name}}">


               </div>
            <div class="form-group">

                  <label>Phone number:</label>
                  <input type="number" class="form-control" name="senderPhoneNumber" value="{{row.sender.phone_number}}">


               </div>


                 <div class="form-group">


                  <label>Receiver</label>
                  <label> First name:</label>
                  <input type="text" class="form-control" name="receiverFirstName" value="{{row.receiver.first_name}}">


               </div>
            <div class="form-group">



                  <label>Last name:</label>
                  <input type="text" class="form-control" name="receiverLastName" value="{{row.receiver.last_name}}">


               </div>
            <div class="form-group">

                  <label>Phone number:</label>
                  <input type="number" class="form-control" name="receiverPhoneNumber" value="{{row.receiver.phone_number}}">


               </div>





            <div class="form-group">




                   <label>Price:</label>
                   <input type="text" id="priceUpdate" style="border:none; width: fit-content;" id="priceUpdate" name="price"  value="{{ row.price }}" readonly><label>lv.</label>
               </div>





               <div class="form-group">


                  <button class="btn btn-primary" type="submit">Update</button>


               </div>


            </form>


         </div>


         <div class="modal-footer">


            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>


         </div>


      </div>


   </div>

</div>


                    {% endfor %}


                </table>


            </div>


        <script type="text/javascript">
                           function checkedFunctionUpdate(radio_id)
                            {
                              if(radio_id == "from_office_update")
                              {
   	                              document.getElementById('select_from_office_update').style.display = 'block';
                                  document.getElementById('from_address_text_update').style.display = 'none';

                               }
                               else if(radio_id == "from_address_update")
                              {
	                              document.getElementById('select_from_office_update').style.display = 'none';
	                              document.getElementById('from_address_text_update').style.display = '';
                              }

                              }

                               document.getElementById("weightUpdate").addEventListener("keyup", calculatePriceUpdate);
                           function calculatePriceUpdate()
                            {
                                let weight = document.getElementById('weightUpdate').value ;
                                if(weight>5){
                                    document.getElementById('priceUpdate').value = 5.00;
                                }
                                else{
                                document.getElementById('priceUpdate').value = 2.50 ;}



                              }

                              function checkedToFunctionUpdate(radio_id)
                            {
                              if(radio_id == 'to_office_update')
                              {
   	                              document.getElementById('select_to_office_update').style.display = 'block';
                                  document.getElementById('to_address_text_update').style.display = 'none';

                               }
                               else if(radio_id == 'to_address_update')
                              {
	                              document.getElementById('select_to_office_update').style.display = 'none';
	                              document.getElementById('to_address_text_update').style.display = '';
                              }

                              }

                    </script>





<div id="mymodal" class="modal fade" role="dialog">
   <div class="modal-dialog">
      <div class="modal-content">
         <div class="modal-header">

            <h4 class="modal-title">Add Shipment</h4>
         </div>
         <div class="modal-body">

            <form action="/client_shipments/insert" method='POST'>


               <div class="form-group">

                  <label>Weight:</label>
                  <input type="number" class="form-control" name="weight" id="weight" onkeyup="calculatePrice()" required="1">


               </div>


                <div class="form-group">

                  <label>From:</label>


                  <input type="radio" id="from_office" name="optionsFrom" value="office" onClick="javascript:return checkedFunction('from_office')" checked>
                          <label for="from_office">Office</label>
                  <input type="radio" id="from_address" name="optionsFrom" value="address" onClick="javascript:return checkedFunction('from_address')" checked>
                          <label for="from_address">Address</label>



                    <input id="from_address_text" type="text" class="form-control" name="fromAddressText"  value="city, complex,street"
                           onfocus="(this.value == 'city, complex,street') && (this.value = '')"
                           onblur="(this.value == '') && (this.value = 'city, complex,street')"
                           required="1">

                    <div id="select_from_office"  style="display: none" required="1" >

                      <select  name="selectFromOffice" >
                           {% for selectFromOffice in offices %}
                          <option value={{selectFromOffice.id}}> {{selectFromOffice.id}}, {{selectFromOffice.address}} </option>
                          {% endfor %}

                      </select>

                    </div>




               </div>




                <div class="form-group">


                  <label>To:</label>
                  <input type="radio" id="to_office" name="optionsTo" value="office" onClick="javascript:return checkedToFunction('to_office')"  checked >
                          <label for="from_office">Office</label>
                  <input type="radio" id="to_address" name="optionsTo" value="address" onClick="javascript:return checkedToFunction('to_address')"  checked>
                          <label for="from_address">Address</label>



                    <input id="to_address_text" type="text" class="form-control" name="toAddressText" value="city, complex,street"
                           onfocus="(this.value == 'city, complex,street') && (this.value = '')"
                           onblur="(this.value == '') && (this.value = 'city, complex,street')"
                           required="1" >

                    <div id="select_to_office" style = "display:none" >
                    <select  name="selectToOffice" required = "1" >
                         {% for row in offices %}
                        <option value={{row.id}} > {{row.id}}, {{row.address}} </option>
                        {% endfor %}

                    </select>
                    </div>





               </div>


             <div class="form-group">


                  <label>Sender</label>
                  <label> First name:</label>
                  <input type="text" class="form-control" name="senderFirstName" required="1">


               </div>
            <div class="form-group">



                  <label>Last name:</label>
                  <input type="text" class="form-control" name="senderLastName" required="1">


               </div>
            <div class="form-group">

                  <label>Phone number:</label>
                  <input type="number" class="form-control" name="senderPhoneNumber" required="1">


               </div>



                 <div class="form-group">


                  <label>Receiver</label>
                  <label> First name:</label>
                  <input type="text" class="form-control" name="receiverFirstName" required="1">


               </div>
            <div class="form-group">



                  <label>Last name:</label>
                  <input type="text" class="form-control" name="receiverLastName" required="1">


               </div>
            <div class="form-group">

                  <label>Phone number:</label>
                  <input type="number" class="form-control" name="receiverPhoneNumber" required="1">


               </div>




               <div class="form-group">

                   <label>Price:</label>
                   <input type="text" style="border:none; " id="price" name="price" value="0.00" required="1" readonly><label>lv.</label>
               </div>


               <div class="form-group">


                  <button class="btn btn-primary" type="submit">Add Shipment</button>


               </div>


            </form>


         </div>


         <div class="modal-footer">


            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>


         </div>


      </div>


   </div>


</div>


        <script type="text/javascript">
                           function checkedFunction(radio_id)
                            {  console.log("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!")
                              if(radio_id == "from_office")
                              {
   	                              document.getElementById('select_from_office').style.display = 'block';
                                  document.getElementById('from_address_text').style.display = 'none';

                               }
                               else if(radio_id == "from_address")
                              {
	                              document.getElementById('select_from_office').style.display = 'none';
	                              document.getElementById('from_address_text').style.display = '';
                              }

                              }

                              function checkedToFunction(radio_id)
                            {
                              if(radio_id == 'to_office')
                              {
   	                              document.getElementById('select_to_office').style.display = 'block';
                                  document.getElementById('to_address_text').style.display = 'none';

                               }
                               else if(radio_id == 'to_address')
                              {
	                              document.getElementById('select_to_office').style.display = 'none';
	                              document.getElementById('to_address_text').style.display = '';
                              }

                              }

                               document.getElementById("weight").addEventListener("keyup", calculatePrice);
                           function calculatePrice()
                            {
                                let weight = document.getElementById('weight').value ;
                                if(weight>5){
                                    document.getElementById('price').value = 5;
                                }
                                else{
                                document.getElementById('price').value = 2 ;}



                              }




                    </script>




        </div>

    </div>


</div>


{% endblock %}
